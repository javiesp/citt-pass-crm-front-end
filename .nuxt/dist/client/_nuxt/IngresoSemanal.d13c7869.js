import{g as X,c as Q,u as x,d as ee}from"./userApi.248f1fe6.js";import{a as L}from"./axios.4d564c32.js";import{g as te}from"./projectApi.98219bc6.js";import{n as oe,_ as le,d as ae,a as d,o as re,e as ne,b as o,w as l,h as f,g as v,F as se}from"./entry.21862ddf.js";L.defaults.validateStatus=function(e){return e>=200&&e<300};const U=L.create({baseURL:"https://citt-pass-api-gateaway-backend-production.up.railway.app",timeout:1e5}),M=localStorage.getItem("accessToken");U.interceptors.request.use(e=>(M&&(e.headers.Authorization=`Bearer ${M}`),e),e=>Promise.reject(e));U.interceptors.response.use(e=>e,e=>Promise.reject(e));const ie=()=>U.get("/check-in/find-all-check-in"),de=(e,t)=>U.get("/check-in/find-by-day-and-user",{params:{date:e,uid_user:t}}),ue=e=>(console.log(e),U.post("/check-in/create-check-in",e));var O={exports:{}},A=1;function ce(){return A=(A*9301+49297)%233280,A/233280}function me(e){A=e}var pe={nextValue:ce,seed:me},S=pe,g="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-",h,F,I;function D(){I=!1}function H(e){if(!e){h!==g&&(h=g,D());return}if(e!==h){if(e.length!==g.length)throw new Error("Custom alphabet for shortid must be "+g.length+" unique characters. You submitted "+e.length+" characters: "+e);var t=e.split("").filter(function(r,s,c){return s!==c.lastIndexOf(r)});if(t.length)throw new Error("Custom alphabet for shortid must be "+g.length+" unique characters. These characters were not unique: "+t.join(", "));h=e,D()}}function fe(e){return H(e),h}function he(e){S.seed(e),F!==e&&(D(),F=e)}function ge(){h||H(g);for(var e=h.split(""),t=[],r=S.nextValue(),s;e.length>0;)r=S.nextValue(),s=Math.floor(r*e.length),t.push(e.splice(s,1)[0]);return t.join("")}function z(){return I||(I=ge(),I)}function ve(e){var t=z();return t[e]}function ye(){return h||g}var q={get:ye,characters:fe,seed:he,lookup:ve,shuffled:z},E=typeof window=="object"&&(window.crypto||window.msCrypto),T;!E||!E.getRandomValues?T=function(e){for(var t=[],r=0;r<e;r++)t.push(Math.floor(Math.random()*256));return t}:T=function(e){return E.getRandomValues(new Uint8Array(e))};var Ve=T,be=function(e,t,r){for(var s=(2<<Math.log(t.length-1)/Math.LN2)-1,c=-~(1.6*s*r/t.length),p="";;)for(var u=e(c),n=c;n--;)if(p+=t[u[n]&s]||"",p.length===+r)return p},we=q,Ie=Ve,Ue=be;function ke(e){for(var t=0,r,s="";!r;)s=s+Ue(Ie,we.get(),1),r=e<Math.pow(16,t+1),t++;return s}var Ce=ke,j=Ce,je=1567752802062,Pe=7,P,B;function Ae(e){var t="",r=Math.floor((Date.now()-je)*.001);return r===B?P++:(P=0,B=r),t=t+j(Pe),t=t+j(e),P>0&&(t=t+j(P)),t=t+j(r),t}var $e=Ae,Re=q;function _e(e){if(!e||typeof e!="string"||e.length<6)return!1;var t=new RegExp("[^"+Re.get().replace(/[|\\{}()[\]^$+*?.-]/g,"\\$&")+"]");return!t.test(e)}var Ee=_e;(function(e){var t=q,r=$e,s=Ee,c=0;function p(i){return t.seed(i),e.exports}function u(i){return c=i,e.exports}function n(i){return i!==void 0&&t.characters(i),t.shuffled()}function m(){return r(c)}e.exports=m,e.exports.generate=m,e.exports.seed=p,e.exports.worker=u,e.exports.characters=n,e.exports.isValid=s})(O);var Se=O.exports,De=Se;const Te=oe(De),qe=ae({data(){return{loading:!1,search:"",itemsPerPage:5,rowsPerPageItems:[{title:"5",value:5},{title:"10",value:10},{title:"25",value:25},{title:"50",value:50}],headers:[{title:"UID",value:"uid_user"},{title:"Nombre",value:"name"},{title:"Mail",value:"email"},{title:"Teléfono",value:"phone"},{title:"ID Proyecto",value:"proyect_id"},{title:"Acciones",value:"actions"},{title:"Lista",value:"checkin"},{title:"Asistencia",value:"asist"}],dialog:!1,dialogCheckin:!1,dialogProject:!1,dialogDelete:!1,dialogUpdate:!1,errorAlertVisible:!1,selectedItem:{},selectItem:null,variant:null,checkInArray:[],usersArray:[],projectArray:[],projectsNames:[],selectorOP:["Proyecto CITT","MMT"],projectId:0,totalRows:0,selectedProyect:null,items:[1,2,3,4,5,6,7,8,9,10],userRole:["Admin citt","Profesor","Alumno","CIA","MMT"],uidUser:["OIUUYFASD","ASDIUAD908","908DKJHAS"],userId:null,UID_USER:[],entryReason:null,entryDate:null,assited:!1,post:{uid_user:null,email:null,phone:null,name:null,hashed_password:null,run:null,project_id:null},itemId:null,errorText:"",passwordVisible:!1,studentName:null,motivoEntrada:null}},computed:{formattedRun:{get(){return this.rutFormat(this.post.run)},set(e){this.post.run=e.replace(/\./g,"").replace(/-/g,"")}}},async created(){let e=localStorage.getItem("project_id");!e||e.trim()===""?this.dialogProject=!0:this.dialogProject=!1,await this.getUsers(),await this.getProjects()},methods:{async checkIfAttendedToday(e){try{const t=new Date,r=`${t.getDate().toString().padStart(2,"0")}/${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getFullYear()}`;return(await de(r,e)).data.length>0}catch(t){return console.error(`Error checking attendance for user ${e}:`,t),!1}},async getUsers(){let e=localStorage.getItem("project_id");this.loading=!0;try{const t=await X(e);this.usersArray=t.data;const r=this.usersArray.map(async s=>{s.asistioHoy=await this.checkIfAttendedToday(s.uid_user)});await Promise.all(r)}catch(t){console.error("Error fetching users:",t),this.errorAlertVisible=!0}finally{this.loading=!1}},async getProjects(){this.loading=!0;try{const e=await te();this.projectArray=e.data,this.projectsNames=this.projectArray.map(t=>t.project_name),this.totalRows=e.data.total}catch(e){console.error("Error al obtener proyectos:",e)}finally{this.loading=!1}},async editItem(e){this.post={...e},this.dialogCheckin=!0,this.userId=e.uid_user,this.studentName=e.name},async updateItem(e){this.post={...e},this.itemId=e._id,this.dialogUpdate=!0},async getCheckIn(){try{const e=await ie();this.checkInArray=e.data}catch(e){console.log(e)}},async createCheckIn(){const e={uid_user:this.userId,entry_date:null,entry_reason:`${this.studentName}: ${this.entryReason} - ${this.motivoEntrada}`,times_entered:null};try{this.loading=!0;const t=await ue(e);window.location.reload(),this.dialogCheckin=!1,this.clearInput()}catch(t){console.log(t)}finally{this.loading=!1}},async createUser(){const t={uid_user:Te.generate(),...this.post};try{await Q(t),await this.getUsers(),this.clearInput(),this.dialog=!1}catch(r){console.log(r)}},async updateUser(){const e={email:this.post.email,phone:this.post.phone,name:this.post.name,run:this.post.run,proyect_id:this.post.project_id};try{await x(this.itemId,e),await this.getUsers(),this.clearInput(),this.dialogUpdate=!1}catch(t){console.log(t),this.errorAlertVisible=!0}},closeUpdate(){this.clearInput(),this.dialogUpdate=!1},selectProject(){this.dialogProject=!1,this.loading=!0;const e=this.selectedItem.id;localStorage.setItem("project_id",e),this.getProjectById()},async getProjectById(){let e=localStorage.getItem("project_id");try{const t=await X(e);this.usersArray=t.data,this.totalRows=t.data.total;const r=this.usersArray.map(async s=>{s.asistioHoy=await this.checkIfAttendedToday(s.uid_user)});await Promise.all(r),window.location.reload()}catch(t){console.error("Error al obtener usuarios:",t)}finally{this.loading=!1}},openDeleteDialog(e){this.dialogDelete=!0,this.itemId=e._id},rutFormat(e){let t=e.replace(/^0+/,"").replace(/\./g,"").replace(/-/g,"");if(t.length>1){let r=t.slice(0,-1),s=t.slice(-1).toUpperCase();return r=r.replace(/\B(?=(\d{3})+(?!\d))/g,"."),`${r}-${s}`}return e},validateRun(e){if(!e)return"El RUT es requerido";const t=e.replace(/\./g,"").replace(/-/g,"");if(!/^\d{7,8}[0-9Kk]$/.test(t))return"RUT inválido";const r=t.slice(0,-1),s=t.slice(-1).toUpperCase();let c=0,p=2;for(let m=r.length-1;m>=0;m--)c+=p*parseInt(r.charAt(m),10),p=p===7?2:p+1;const u=c%11,n=u===0?"0":u===1?"K":(11-u).toString();return s!==n?"RUT inválido":!0},onInput(){this.$forceUpdate()},phoneFormat(e){let t=e.replace(/\D/g,"");return t.startsWith("9")&&(t.length===8||t.length===9)?t.length===9?`${t.slice(0,1)}${t.slice(1,5)}${t.slice(5)}`:`${t.slice(0,1)}${t.slice(1,4)}${t.slice(4)}`:e},validateEmail(e){return e?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?!0:"El correo debe tener un formato válido y no contener espacios ni símbolos inválidos":"El correo es obligatorio"},validatePassword(e){return e?e.length<9?"La contraseña debe tener al menos 9 caracteres":/[a-zA-Z0-9!@#$%^&*()_+{}\[\]:;"'<>,.?~`-]/.test(e)?!0:"La contraseña debe contener al menos una letra, símbolo o número":"La contraseña es obligatoria"},async deleteItem(){try{this.loading=!0,await ee(this.itemId),await this.getUsers(),this.dialogDelete=!1}catch(e){console.error(e)}finally{this.loading=!1}},logout(){localStorage.removeItem("project_id"),this.dialogProject=!0},downloadPdf(){const e=document.createElement("a");e.href=this.pdfUrl,e.target="_blank",e.download=this.pdfFileName,document.body.appendChild(e),e.click(),document.body.removeChild(e)},clearInput(){this.post={uid_user:null,email:null,phone:null,name:null,hashed_password:null,run:null,project_id:null}}},watch:{selectedProyect:function(e,t){e!==t&&this.getUsers()}}}),Ne={class:"pa-4 text-center"},Xe=v("small",{class:"text-caption text-medium-emphasis"},"* Indica que el campo es obligatorio",-1),Me={class:"pa-4 text-center"},Fe=v("small",{class:"text-caption text-medium-emphasis"},"* Indica que el campo es obligatorio",-1),Be=v("span",{class:"my-letra"},"Proyecto",-1),Le=v("p",{class:"letra-abajo"}," Es necesario que seleccione su proyecto para poder gestionar ",-1),Oe=v("span",null,"Confirmar Eliminación",-1);function He(e,t,r,s,c,p){const u=d("v-text-field"),n=d("v-col"),m=d("v-spacer"),i=d("v-btn"),$=d("v-divider"),N=d("v-icon"),K=d("v-switch"),Y=d("v-data-table"),y=d("v-card"),V=d("v-row"),R=d("v-card-title"),W=d("v-textarea"),G=d("v-select"),b=d("v-card-text"),w=d("v-dialog"),_=d("v-autocomplete"),k=d("v-card-actions"),J=d("v-container"),Z=d("v-alert");return re(),ne(se,null,[o(V,{class:"month-table"},{default:l(()=>[o(n,{cols:"3"},{default:l(()=>[o(u,{modelValue:e.search,"onUpdate:modelValue":t[0]||(t[0]=a=>e.search=a),class:"mx-auto",density:"comfortable","menu-icon":"",placeholder:"Buscar Usuario","prepend-inner-icon":"mdi-magnify",theme:"light",variant:"solo","auto-select-first":"","item-props":"",hint:"Escriba para buscar",rounded:""},null,8,["modelValue"])]),_:1}),o(n,{cols:"3"},{default:l(()=>[o(m),o(i,{variant:"tonal",color:"primary","prepend-icon":"mdi-account",onClick:t[1]||(t[1]=a=>e.dialog=!0),text:"Registrar nuevo usuario"})]),_:1}),o(n,{cols:"3"},{default:l(()=>[o(m),o(i,{variant:"tonal",color:"red","prepend-icon":"mdi-logout",onClick:e.logout,text:"cambiar de proyecto"},null,8,["onClick"])]),_:1}),o(n,{cols:"12",sm:"12"},{default:l(()=>[o(y,{class:"mx-auto"},{default:l(()=>[o($),o(n,null,{default:l(()=>[o(Y,{"items-per-page":e.itemsPerPage,"onUpdate:itemsPerPage":t[2]||(t[2]=a=>e.itemsPerPage=a),"items-per-page-options":e.rowsPerPageItems,headers:e.headers,items:e.usersArray,loading:e.loading,search:e.search,"item-key":"uid_user"},{"item.actions":l(({item:a})=>[o(i,{class:"ml-2",color:"error",icon:"",size:"x-small",flat:"",onClick:C=>e.openDeleteDialog(a)},{default:l(()=>[o(N,null,{default:l(()=>[f("mdi-delete")]),_:1})]),_:2},1032,["onClick"]),o(i,{class:"ml-2",color:"primary",icon:"",size:"x-small",flat:"",onClick:C=>e.updateItem(a)},{default:l(()=>[o(N,null,{default:l(()=>[f("mdi-pencil")]),_:1})]),_:2},1032,["onClick"])]),"item.checkin":l(({item:a})=>[o(i,{class:"ml-2",color:"primary",flat:"",onClick:C=>e.editItem(a)},{default:l(()=>[f(" Ingresar ")]),_:2},1032,["onClick"])]),"item.asist":l(({item:a})=>[o(K,{modelValue:a.asistioHoy,"onUpdate:modelValue":C=>a.asistioHoy=C,inset:"",color:"primary"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["items-per-page","items-per-page-options","headers","items","loading","search"])]),_:1})]),_:1})]),_:1})]),_:1}),o(w,{modelValue:e.dialogCheckin,"onUpdate:modelValue":t[6]||(t[6]=a=>e.dialogCheckin=a),"max-width":"600"},{default:l(()=>[o(y,null,{default:l(()=>[o(R,null,{default:l(()=>[f("Registrar ingreso citt")]),_:1}),o(b,null,{default:l(()=>[o(V,null,{default:l(()=>[o(n,null,{default:l(()=>[o(W,{modelValue:e.entryReason,"onUpdate:modelValue":t[3]||(t[3]=a=>e.entryReason=a),label:"Motivo"},null,8,["modelValue"])]),_:1}),o(n,null,{default:l(()=>[o(G,{modelValue:e.motivoEntrada,"onUpdate:modelValue":t[4]||(t[4]=a=>e.motivoEntrada=a),items:e.selectorOP,label:"Seleciona una opción"},null,8,["modelValue","items"])]),_:1})]),_:1}),o(i,{class:"ml-2",flat:"",onClick:t[5]||(t[5]=a=>e.dialogCheckin=!1)},{default:l(()=>[f(" Cancelar ")]),_:1}),o(i,{class:"ml-2",color:"primary",flat:"",onClick:e.createCheckIn},{default:l(()=>[f(" Registrar ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),v("div",Ne,[o(w,{modelValue:e.dialog,"onUpdate:modelValue":t[16]||(t[16]=a=>e.dialog=a),"max-width":"600"},{default:l(()=>[o(y,{"prepend-icon":"mdi-account",title:"Crear Usuario"},{default:l(()=>[o(b,null,{default:l(()=>[o(V,{dense:""},{default:l(()=>[o(n,{cols:"12",md:"4",sm:"6"},{default:l(()=>[o(u,{modelValue:e.post.name,"onUpdate:modelValue":t[7]||(t[7]=a=>e.post.name=a),label:"Nombre*",required:""},null,8,["modelValue"])]),_:1}),o(n,{cols:"12",md:"4",sm:"6"},{default:l(()=>[o(u,{modelValue:e.post.email,"onUpdate:modelValue":t[8]||(t[8]=a=>e.post.email=a),hint:"email@duocuc.cl/ email@profesor.duoc.cl",label:"Email*",rules:[e.validateEmail],required:""},null,8,["modelValue","rules"])]),_:1}),o(n,{cols:"12",md:"4",sm:"6"},{default:l(()=>[o(u,{modelValue:e.post.phone,"onUpdate:modelValue":t[9]||(t[9]=a=>e.post.phone=a),hint:"Ej: +56 9 XXXX XXXX",label:"Teléfono*",required:"",rules:[e.validatePhone],onInput:t[10]||(t[10]=a=>e.post.phone=e.phoneFormat(e.post.phone))},null,8,["modelValue","rules"])]),_:1}),o(n,{cols:"12",md:"4",sm:"6"},{default:l(()=>[o(u,{modelValue:e.post.run,"onUpdate:modelValue":t[11]||(t[11]=a=>e.post.run=a),hint:"Ingresa el RUT sin puntos ni guion",label:"RUT*",rules:[e.validateRun],required:""},null,8,["modelValue","rules"])]),_:1}),o(n,{cols:"12",md:"4",sm:"6"},{default:l(()=>[o(u,{modelValue:e.post.password,"onUpdate:modelValue":t[12]||(t[12]=a=>e.post.password=a),hint:"Debe tener al menos 9 caracteres y contener al menos una letra, símbolo o número",label:"Contraseña*",rules:[e.validatePassword],required:"",type:e.passwordVisible?"text":"password","append-icon":"mdi-eye","onClick:append":t[13]||(t[13]=a=>e.passwordVisible=!e.passwordVisible)},null,8,["modelValue","rules","type"])]),_:1}),o(n,{cols:"12",sm:"6"},{default:l(()=>[o(_,{modelValue:e.post.project_id,"onUpdate:modelValue":t[14]||(t[14]=a=>e.post.project_id=a),label:"Selecciona un proyecto...",items:e.projectArray,"item-value":"project_id","item-title":"project_name",variant:"underlined",onChange:e.selectItem},null,8,["modelValue","items","onChange"])]),_:1})]),_:1}),Xe]),_:1}),o($),o(k,null,{default:l(()=>[o(m),o(i,{text:"Cerrar",variant:"plain",onClick:t[15]||(t[15]=a=>e.dialog=!1)}),o(i,{color:"primary",text:"Crear usuario",variant:"tonal",onClick:e.createUser,disabled:!e.isFormValid()},null,8,["onClick","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),v("div",Me,[o(w,{modelValue:e.dialogUpdate,"onUpdate:modelValue":t[24]||(t[24]=a=>e.dialogUpdate=a),"max-width":"600"},{default:l(()=>[o(y,{"prepend-icon":"mdi-account",title:"Crear Usuario"},{default:l(()=>[o(b,null,{default:l(()=>[o(V,{dense:""},{default:l(()=>[o(n,{cols:"12",md:"4",sm:"6"},{default:l(()=>[o(u,{modelValue:e.post.name,"onUpdate:modelValue":t[17]||(t[17]=a=>e.post.name=a),label:"Nombre*",required:""},null,8,["modelValue"])]),_:1}),o(n,{cols:"12",md:"4",sm:"6"},{default:l(()=>[o(u,{modelValue:e.post.email,"onUpdate:modelValue":t[18]||(t[18]=a=>e.post.email=a),hint:"email@duocuc.cl/ email@profesor.duoc.cl",label:"Email*",rules:[e.validateEmail],required:""},null,8,["modelValue","rules"])]),_:1}),o(n,{cols:"12",md:"4",sm:"6"},{default:l(()=>[o(u,{modelValue:e.post.phone,"onUpdate:modelValue":t[19]||(t[19]=a=>e.post.phone=a),hint:"Ej: +56 9 XXXX XXXX",label:"Teléfono*",required:"",rules:[e.validatePhone],onInput:t[20]||(t[20]=a=>e.post.phone=e.phoneFormat(e.post.phone))},null,8,["modelValue","rules"])]),_:1}),o(n,{cols:"12",md:"4",sm:"6"},{default:l(()=>[o(u,{modelValue:e.post.run,"onUpdate:modelValue":t[21]||(t[21]=a=>e.post.run=a),hint:"Ingresa el RUT sin puntos ni guion",label:"RUT*",rules:[e.validateRun],required:""},null,8,["modelValue","rules"])]),_:1}),o(n,{cols:"12",sm:"6"},{default:l(()=>[o(_,{modelValue:e.post.project_id,"onUpdate:modelValue":t[22]||(t[22]=a=>e.post.project_id=a),label:"Selecciona un proyecto...",items:e.projectArray,"item-value":"project_id","item-title":"project_name",variant:"underlined",onChange:e.selectItem},null,8,["modelValue","items","onChange"])]),_:1})]),_:1}),Fe]),_:1}),o($),o(k,null,{default:l(()=>[o(m),o(i,{text:"Cerrar",variant:"plain",onClick:t[23]||(t[23]=a=>e.closeUpdate())}),o(i,{color:"primary",text:"Crear usuario",variant:"tonal",onClick:e.updateUser},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),o(w,{modelValue:e.dialogProject,"onUpdate:modelValue":t[26]||(t[26]=a=>e.dialogProject=a),persistent:"",width:"600"},{default:l(()=>[o(y,null,{default:l(()=>[o(R,null,{default:l(()=>[Be]),_:1}),o(b,null,{default:l(()=>[o(J,null,{default:l(()=>[o(V,null,{default:l(()=>[o(n,{cols:"12"},{default:l(()=>[o(_,{modelValue:e.selectedItem.id,"onUpdate:modelValue":t[25]||(t[25]=a=>e.selectedItem.id=a),label:"Selecciona un proyecto...",items:e.projectArray,"item-value":"project_id","item-title":"project_name",variant:"underlined"},null,8,["modelValue","items"]),Le]),_:1})]),_:1})]),_:1})]),_:1}),o(k,null,{default:l(()=>[o(m),o(i,{color:"primary",rounded:!0,elevation:"2",variant:"text",onClick:e.selectProject},{default:l(()=>[f(" Login ")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(w,{modelValue:e.dialogDelete,"onUpdate:modelValue":t[28]||(t[28]=a=>e.dialogDelete=a),persistent:"","max-width":"500px"},{default:l(()=>[o(y,null,{default:l(()=>[o(R,null,{default:l(()=>[Oe]),_:1}),o(b,null,{default:l(()=>[f(" ¿Estás seguro de que deseas eliminar esto? ")]),_:1}),o(k,null,{default:l(()=>[o(i,{onClick:t[27]||(t[27]=a=>e.dialogDelete=!1)},{default:l(()=>[f("Cancelar")]),_:1}),o(i,{color:"red",onClick:e.deleteItem},{default:l(()=>[f("Eliminar")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(Z,{modelValue:e.errorAlertVisible,"onUpdate:modelValue":t[29]||(t[29]=a=>e.errorAlertVisible=a),dismissible:"",color:"red",elevation:"2","colored-border":"",icon:"mdi-alert",timeout:"5000"},{default:l(()=>[f(" Oops! Ha ocurrido un problema. ")]),_:1},8,["modelValue"])],64)}const Ge=le(qe,[["render",He]]);export{Ge as I,ie as g};
