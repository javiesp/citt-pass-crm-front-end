import{a as h}from"./axios.4d564c32.js";import{g as q,c as F,u as M,a as z}from"./wishlistApi.8f919075.js";import{_ as G,d as H,a as l,e as W,b as t,w as s,g as k,F as U,o as d,h as r,c as V,f as J,t as u}from"./entry.b5b73911.js";h.defaults.validateStatus=function(e){return e>=200&&e<300};const y=h.create({baseURL:"https://citt-pass-api-gateaway-backend-production.up.railway.app",timeout:1e5}),S=localStorage.getItem("accessToken");y.interceptors.request.use(e=>(S&&(e.headers.Authorization=`Bearer ${S}`),e),e=>Promise.reject(e));y.interceptors.response.use(e=>e,e=>Promise.reject(e));const K=()=>y.get("https://api-integracion.sbgtech.workers.dev/prodasd ucts");h.defaults.validateStatus=function(e){return e>=200&&e<300};const v=h.create({baseURL:"https://citt-pass-api-gateaway-backend-production.up.railway.app",timeout:1e5}),I=localStorage.getItem("accessToken");v.interceptors.request.use(e=>(I&&(e.headers.Authorization=`Bearer ${I}`),e),e=>Promise.reject(e));v.interceptors.response.use(e=>e,e=>Promise.reject(e));const X=()=>v.get("/item/find-all-items"),Y=H({name:"productItem",data(){return{dialog:!1,dialogWishlist:!1,dialogCreateWishlist:!1,loading:!1,productArray:[],productNames:[],wishlistId:null,wishlistArray:[],wishNames:[],productSearchQuery:"",selectedProducts:{},productsFor:[],dialogVisible:!1,alertVisible:!1,errorAlertVisible:!1,loading:!1,isDisabled:!0,selectedWishlist:"",wishlistNameToIdMap:{},post:{wishlist_id:null,wishlist_name:null,budget:null,product:null},ProductDto:[],count:0,totalPrice:0,productName:null,productStock:null,wihslistBudget:null,itemArray:[],itemNames:null}},computed:{filteredProducts(){return console.log("INPUT: ",this.productSearchQuery),this.productSearchQuery?(this.productArray.results||[]).filter(e=>e.name.toLowerCase().includes(this.productSearchQuery.toLowerCase())):(console.log("OUTPUT: ",this.productArray.results),this.productArray.results||[])},filteredItem(){return console.log("INPUT: ",this.productSearchQuery),this.productSearchQuery?(this.itemArray.results||[]).filter(e=>e.item_name.toLowerCase().includes(this.productSearchQuery.toLowerCase())):(console.log("OUTPUT: ",this.itemArray.results),this.itemArray.results||[])}},methods:{async getProduct(){try{this.loading=!0;const e=await K();console.log("INPUT: ",e),this.productArray=e.data,this.productNames=this.productArray.results.map(o=>o.name),console.log("OUTPUT: ",this.productArray),this.loading=!1}catch(e){console.error("PRODUCT_ERROR:",e),this.errorAlertVisible=!0}},async getItem(){try{this.loading=!0;const e=await X();console.log("INPUT ITEMS: ",e),this.itemArray=e.data,console.log("OUTPUT ITEMS: ",this.itemArray),this.loading=!1}catch(e){console.error("PRODUCT_ERROR:",e),this.errorAlertVisible=!0}},async getWishlist(){try{const e=await q();console.log("INPUT: ",e),this.wishlistArray=e.data,this.wishlistNameToIdMap=this.wishlistArray.reduce((o,c)=>(o[c.wishlist_name]=c.wishlist_id,o),{}),this.wishNames=this.wishlistArray.map(o=>o.wishlist_name),console.log("OUTPUT: ",this.wishlistArray)}catch(e){console.error("Error fetching wishlists:",e),this.errorAlertVisible=!0}},addProductToWishlist(e){console.log("HOLA",e);const o={product_id:e.id,product_name:e.name,price:e.price,quantity:this.count};this.selectedProducts=o,this.productName=this.selectedProducts.product_name,this.productStock=e.stock,console.log("INPUT: ",e),this.dialogWishlist=!0,console.log("OUTPUT: ",this.selectedWishlist,"/",this.selectedProducts),this.isDisabled=!1},incrementCount(){this.isDisabled=!0,this.count<this.productStock?(this.count++,this.totalPrice+=this.selectedProducts.price,this.selectedProducts.quantity=this.count,console.log("Producto incrementado:",this.selectedProducts.name),console.log("Contador actual:",this.count),console.log("Precio Total:",this.totalPrice)):console.log("No se puede incrementar más, stock insuficiente")},decrementCount(){this.count>0?(this.count--,this.totalPrice-=this.selectedProducts.price,console.log("Producto decrementado:",this.selectedProducts.name),console.log("Contador actual:",this.count),console.log("Precio Total:",this.totalPrice)):(this.isDisabled=!1,console.log("No se puede decrementar más, cantidad mínima alcanzada"))},async createWishlist(){const e={wishlist_id:Math.random(),wishlist_name:this.post.wishlist_name,budget:0,product:this.ProductDto};try{this.loading=!0;const o=await F(e);console.log("POST"),console.log(o),this.loading=!1,this.dialogCreateWishlist=!1}catch(o){console.error("item error:",o),this.errorAlertVisible=!0}},openCreateDialog(){this.dialog=!0},closeCreateDialog(){this.dialogWishlist=!1},async saveWishlistId(){console.log("WISHLIST SELECCIONADA"),console.log(this.selectedWishlist),console.log("PRODUCTOS SELECCIONADOS"),console.log(this.selectedProducts);try{this.loading=!0;const e=this.wishlistArray.find(p=>p._id===this.selectedWishlist);if(!e)throw new Error("Wishlist no encontrada");const o=e.budget||0;console.log("Presupuesto actual",o);const c=await M(this.selectedWishlist,this.selectedProducts);console.log(c);const m=o+this.totalPrice;console.log("Presupuesto final",m);const P={budget:m},w=await z(this.selectedWishlist,P);console.log("PUT"),console.log(w),this.dialogWishlist=!1,this.selectedProducts={},console.log("AGREGADO"),this.loading=!1}catch(e){console.log(e),this.loading=!1}console.log("PASS"),this.resetFields()},resetFields(){this.totalPrice=0,this.count=0,this.post.wishlist_name=""}},mounted(){this.getProduct(),this.getWishlist(),this.getItem()}}),Z={class:"pa-4 text-center"};function x(e,o,c,m,P,w){const p=l("v-autocomplete"),a=l("v-col"),n=l("v-btn"),N=l("v-progress-circular"),C=l("v-card-title"),b=l("v-icon"),g=l("v-card-text"),f=l("v-card"),_=l("v-row"),O=l("v-list-item-title"),D=l("v-avatar"),E=l("v-list-item"),R=l("v-text"),L=l("v-select"),A=l("v-card-actions"),T=l("v-dialog"),$=l("v-text-field"),B=l("v-divider"),Q=l("v-spacer"),j=l("v-alert");return d(),W(U,null,[t(_,{class:"month-table"},{default:s(()=>[t(a,{cols:"3"},{default:s(()=>[t(p,{items:e.itemArray,"item-value":"itemArray.item_name",class:"mx-auto",density:"comfortable","menu-icon":"",placeholder:"Buscar Producto","prepend-inner-icon":"mdi-magnify",style:{"max-width":"350px"},theme:"light",variant:"solo","auto-select-first":"",modelValue:e.productSearchQuery,"onUpdate:modelValue":o[0]||(o[0]=i=>e.productSearchQuery=i),"item-props":"",hint:"Escriba para buscar",rounded:""},null,8,["items","modelValue"])]),_:1}),t(a,{cols:"6"},{default:s(()=>[t(n,{variant:"tonal",color:"primary","prepend-icon":"mdi-folder-outline",onClick:o[1]||(o[1]=i=>e.dialogCreateWishlist=!0)},{default:s(()=>[r(" Crear wishlist ")]),_:1})]),_:1}),e.loading?(d(),V(a,{key:0,cols:"12",class:"text-center"},{default:s(()=>[t(N,{size:200,width:17,color:"primary",indeterminate:""})]),_:1})):(d(!0),W(U,{key:1},J(e.itemArray,i=>(d(),V(a,{key:i.id,class:"item-card",cols:"12",md:"4"},{default:s(()=>[t(f,null,{default:s(()=>[t(C,null,{default:s(()=>[r(u(i.item_name),1)]),_:2},1024),t(g,null,{default:s(()=>[k("p",null,"Price: "+u(i.item_price),1),t(n,{icon:"",onClick:ee=>e.addProductToWishlist(i)},{default:s(()=>[t(b,null,{default:s(()=>[r("mdi-heart")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),t(T,{modelValue:e.dialogWishlist,"onUpdate:modelValue":o[3]||(o[3]=i=>e.dialogWishlist=i),"max-width":"500px"},{default:s(()=>[t(f,null,{default:s(()=>[t(C,null,{default:s(()=>[r("Agregar producto a lista de deseos")]),_:1}),t(g,null,{default:s(()=>[t(E,{subtitle:e.precio},{prepend:s(()=>[t(D,{color:"grey-lighten-1"},{default:s(()=>[t(b,{color:"white"},{default:s(()=>[r("mdi-shopping")]),_:1})]),_:1})]),append:s(()=>[t(a,null,{default:s(()=>[t(_,null,{default:s(()=>[t(n,{density:"compact",icon:"mdi-minus",onClick:e.decrementCount},null,8,["onClick"]),t(n,{density:"compact",icon:"mdi-plus",onClick:e.incrementCount},null,8,["onClick"])]),_:1})]),_:1})]),default:s(()=>[t(O,null,{default:s(()=>[r(u(e.productName),1)]),_:1})]),_:1},8,["subtitle"]),t(a,null,{default:s(()=>[t(R,null,{default:s(()=>[r(" Total: "+u(e.totalPrice),1)]),_:1})]),_:1}),t(a,null,{default:s(()=>[t(L,{items:e.wishlistArray,label:"Selecciona la wishlist",modelValue:e.selectedWishlist,"onUpdate:modelValue":o[2]||(o[2]=i=>e.selectedWishlist=i),"item-value":"_id","item-title":"wishlist_name",disabled:!e.isDisabled,dense:""},null,8,["items","modelValue","disabled"])]),_:1})]),_:1}),t(A,null,{default:s(()=>[t(n,{onClick:e.closeCreateDialog},{default:s(()=>[r("Cerrar")]),_:1},8,["onClick"]),t(n,{color:"primary",disabled:!e.isDisabled,onClick:e.saveWishlistId},{default:s(()=>[r("Guardar")]),_:1},8,["disabled","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),k("div",Z,[t(T,{modelValue:e.dialogCreateWishlist,"onUpdate:modelValue":o[6]||(o[6]=i=>e.dialogCreateWishlist=i),"max-width":"600"},{default:s(()=>[t(f,{"prepend-icon":"mdi-heart",title:"Crear lista de deseos"},{default:s(()=>[t(g,null,{default:s(()=>[t(_,{dense:""},{default:s(()=>[t(a,{cols:"12",md:"12",sm:"6"},{default:s(()=>[t($,{modelValue:e.post.wishlist_name,"onUpdate:modelValue":o[4]||(o[4]=i=>e.post.wishlist_name=i),label:"Nombre de la lista",required:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(B),t(A,null,{default:s(()=>[t(Q),t(n,{text:"Cerrar",variant:"plain",onClick:o[5]||(o[5]=i=>e.dialogCreateWishlist=!1)}),t(n,{color:"primary",text:"Crear",variant:"tonal",onClick:e.createWishlist},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),t(j,{modelValue:e.errorAlertVisible,"onUpdate:modelValue":o[7]||(o[7]=i=>e.errorAlertVisible=i),dismissible:"",color:"red",border:"left",elevation:"2","colored-border":"",icon:"mdi-alert",timeout:"5000"},{default:s(()=>[r(" Oops! Ha ocurrido un problema. ")]),_:1},8,["modelValue"])],64)}const le=G(Y,[["render",x]]);export{le as default};
