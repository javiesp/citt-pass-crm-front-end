import{g as z,u as H,a as J}from"./wishlistApi.262a6be6.js";import{a as T}from"./axios.4d564c32.js";import{f as K,g as X,h as Y,i as Z,j as x}from"./itemApi.4a175f94.js";import{_ as ee,d as te,a,e as b,b as t,w as o,c,F as w,j as le,o as n,h as i,f as B,t as m,g as P,p as oe,i as se}from"./entry.5d6c19b6.js";import"./index.fa76b92a.js";T.defaults.validateStatus=function(e){return e>=200&&e<300};const I=T.create({baseURL:"https://citt-pass-api-gateaway-backend-production.up.railway.app",timeout:1e5}),R=localStorage.getItem("accessToken");I.interceptors.request.use(e=>(R&&(e.headers.Authorization=`Bearer ${R}`),e),e=>Promise.reject(e));I.interceptors.response.use(e=>e,e=>Promise.reject(e));const ie=e=>I.get("/product/find-product-by-itemid",{params:{item_id:e}}),ae=e=>I.post("/product/create-product",e),re=(e,l)=>I.put(`/product/update-product/${e}`,l);const de=te({name:"productItem",data(){return{dialog:!1,dialogWishlist:!1,dialogCreateWishlist:!1,dialogCreateItem:!1,dialogUpdateItem:!1,dialogDeleteItem:!1,productDialog:!1,loading:!1,productArray:[],productNames:[],wishlistId:null,wishlistArray:[],wishNames:[],productSearchQuery:"",selectedProducts:{},productsFor:[],dialogVisible:!1,alertVisible:!1,errorAlertVisible:!1,isDisabled:!0,selectedWishlist:"",wishlistNameToIdMap:{},post:{wishlist_id:null,wishlist_name:null,budget:null,product:null},ProductDto:[],count:0,totalPrice:0,productName:null,productStock:null,wihslistBudget:null,itemArray:[],itemNames:null,itemsPerPage:9,currentPage:1,allItems:[],product:[],product_price:0,product_stock:0,productPost:{product_price:null,product_stock:null,item_id:null},itemPosts:{item_id:null,item_name:null,item_price:null,category:null,inventory_id:null},inventory_array:[],selectItem:null,itemId:null,productId:null}},computed:{filteredProducts(){return this.productSearchQuery?this.allItems.filter(e=>e.item_name.toLowerCase().includes(this.productSearchQuery.toLowerCase())).slice((this.currentPage-1)*this.itemsPerPage,this.currentPage*this.itemsPerPage):this.itemArray},totalPages(){const e=this.productSearchQuery?this.allItems.filter(l=>l.item_name.toLowerCase().includes(this.productSearchQuery.toLowerCase())).length:this.allItems.length;return Math.ceil(e/this.itemsPerPage)}},watch:{productSearchQuery(){this.currentPage=1,this.fetchItemsForPage(1)},"itemPosts.inventory_id":function(e){}},methods:{verifyTokenAuth(e){const l=le();e||l.push("/login"),typeof e=="string"&&e.split(".").length!==3&&l.push("/login")},async getItem(){try{this.loading=!0;const e=await K();this.allItems=e.data,this.fetchItemsForPage(1),this.loading=!1}catch(e){console.error("PRODUCT_ERROR:",e),this.errorAlertVisible=!0,this.loading=!1}},async getInventory(){try{const e=await X();this.inventory_array=e.data}catch(e){console.error("Error fetching inventory:",e)}},fetchItemsForPage(e){this.currentPage=e;const l=(e-1)*this.itemsPerPage,p=e*this.itemsPerPage;this.productSearchQuery?this.itemArray=this.filteredProducts:this.itemArray=this.allItems.slice(l,p)},openProductInfo(e){this.productDialog=!0,this.getProductByid(e)},async getProductByid(e){try{const l=await ie(e);this.product=l.data,this.product_price=this.product.product_price,this.product_stock=this.product.product_stock,this.productId=this.product._id,this.productPost=this.product}catch(l){console.log(l)}},reset(){this.product=[],this.product_price=0,this.product_stock=0,this.productDialog=!1},handlePageChange(e){this.fetchItemsForPage(e)},async getWishlist(){try{const e=await z();this.wishlistArray=e.data,this.wishlistNameToIdMap=this.wishlistArray.reduce((l,p)=>(l[p.wishlist_name]=p.wishlist_id,l),{}),this.wishNames=this.wishlistArray.map(l=>l.wishlist_name)}catch(e){console.error("Error fetching wishlists:",e),this.errorAlertVisible=!0}},addProductToWishlist(e){const l={product_id:e.id,product_name:e.item_name,price:e.item_price,quantity:this.count};this.selectedProducts=l,this.productName=this.selectedProducts.product_name,this.productStock=e.stock,this.dialogWishlist=!0,this.isDisabled=!1},incrementCount(){this.isDisabled=!0,this.count<this.productStock&&(this.count++,this.totalPrice+=this.selectedProducts.price,this.selectedProducts.quantity=this.count)},decrementCount(){this.count>0?(this.count--,this.totalPrice-=this.selectedProducts.price):this.isDisabled=!1},async createItem(){this.itemPosts.item_id=Math.floor(Math.random()*(123123123123-1+1))+1;const e={item_id:this.itemPosts.item_id,item_name:this.itemPosts.item_name,item_price:this.itemPosts.item_price,category:this.itemPosts.category,inventory_id:this.itemPosts.inventory_id};try{await Y(e)&&(this.getItem(),this.createProduct(),this.dialogCreateItem=!1,this.resetPost(),this.loading=!1)}catch(l){console.log(l)}},async createProduct(){const e={product_id:Math.floor(Math.random()*123123123123)+1,product_price:this.itemPosts.item_price,product_stock:this.productPost.product_stock,item_id:this.itemPosts.item_id};try{const l=await ae(e)}catch(l){console.log(l)}},openUpdate(e){this.dialogUpdateItem=!0,this.itemId=e._id,this.itemPosts=e,this.getProductByid(e.item_id)},async updateItem(){const e={item_name:this.itemPosts.item_name,item_price:this.itemPosts.item_price,category:this.itemPosts.category,inventory_id:this.itemPosts.inventory_id};try{await Z(this.itemId,e)&&(this.loading=!1,this.dialogUpdateItem=!1,this.updateProduct(),this.getItem(),this.resetPost())}catch(l){console.log(l)}},async updateProduct(){const e={product_price:this.itemPosts.item_price,product_stock:this.productPost.product_stock,item_id:this.itemPosts.item_id};try{const l=await re(this.productId,e)}catch(l){console.log(l)}},openDelete(e){this.dialogDeleteItem=!0,this.itemId=e._id,this.itemPosts=e},async deleteItem(){try{const e=await x(this.itemId);this.getItem(),this.resetPost(),this.dialogDeleteItem=!1}catch(e){console.log(e)}},closeUpdate(){this.resetPost(),this.dialogUpdateItem=!1},closeCreate(){this.resetPost(),this.dialogCreateItem=!1},async saveWishlistId(){try{this.loading=!0;const e=this.wishlistArray.find(A=>A._id===this.selectedWishlist);if(!e)throw new Error("Wishlist no encontrada");const l=e.budget||0;await H(this.selectedWishlist,this.selectedProducts);const U={budget:l+this.totalPrice};await J(this.selectedWishlist,U),this.dialogWishlist=!1,this.selectedProducts={},this.loading=!1}catch(e){console.log(e),this.loading=!1}this.resetFields()},resetFields(){this.totalPrice=0,this.count=0,this.post.wishlist_name=""},resetPost(){this.product_price=0,this.product_stock=0,this.productPost={product_price:null,product_stock:null,item_id:null},this.itemPosts={item_name:null,item_price:null,category:null,inventory_id:null}},closeCreateDialog(){this.dialogWishlist=!1,this.resetFields()}},mounted(){const e=localStorage.getItem("accessToken");this.verifyTokenAuth(e),this.getWishlist(),this.getItem(),this.getInventory(),console.log("INVENTARIO",this.inventory_array)}}),F=e=>(oe("data-v-1dddf4f7"),e=e(),se(),e),ne={class:"mb-2"},ue=F(()=>P("strong",null,"Precio: ",-1)),ce=F(()=>P("p",null,"Desea agregar el producto seleccionado a la wishlist?",-1)),me={class:"mx-4"},pe={class:"mt-4"};function he(e,l,p,U,A,_e){const r=a("v-btn"),d=a("v-col"),h=a("v-row"),E=a("v-skeleton-loader"),V=a("v-card-title"),j=a("v-card-content"),u=a("v-icon"),L=a("v-chip"),C=a("v-divider"),_=a("v-card-text"),f=a("v-card-actions"),g=a("v-card"),M=a("v-pagination"),D=a("v-list-item-title"),W=a("v-list-item-subtitle"),S=a("v-list-item"),Q=a("v-list"),v=a("v-dialog"),y=a("v-text-field"),k=a("v-autocomplete"),$=a("v-container"),N=a("v-form"),O=a("v-card-subtitle"),G=a("v-select");return n(),b(w,null,[t(h,null,{default:o(()=>[t(d,{cols:"2"},{default:o(()=>[t(r,{variant:"tonal",color:"primary","prepend-icon":"mdi-folder-outline",onClick:l[0]||(l[0]=s=>e.dialogCreateItem=!0)},{default:o(()=>[i(" Agregar Item ")]),_:1})]),_:1})]),_:1}),e.loading?(n(),c(h,{key:0,class:"month-table"},{default:o(()=>[(n(),b(w,null,B(10,s=>t(d,{key:s,cols:"12",md:"4"},{default:o(()=>[t(E,{elevation:6,type:"card-avatar"})]),_:2},1024)),64))]),_:1})):(n(),c(h,{key:1,class:"month-table"},{default:o(()=>[(n(!0),b(w,null,B(e.filteredProducts,s=>(n(),c(d,{key:s.id,class:"item-card",cols:"12",md:"4"},{default:o(()=>[t(g,null,{default:o(()=>[t(V,null,{default:o(()=>[i(m(s.item_name),1)]),_:2},1024),t(j),t(_,null,{default:o(()=>[P("p",ne,[ue,i(m(s.item_price),1)]),t(L,{class:"ma-2"},{default:o(()=>[s.category==="Sensor"?(n(),c(u,{key:0},{default:o(()=>[i("mdi-leak")]),_:1})):s.category==="Arduino"?(n(),c(u,{key:1},{default:o(()=>[i("mdi-chip")]),_:1})):s.category==="Raspberry"?(n(),c(u,{key:2},{default:o(()=>[i("mdi-memory")]),_:1})):s.category==="Robótica"?(n(),c(u,{key:3},{default:o(()=>[i("mdi-robot-excited")]),_:1})):s.category==="3D"?(n(),c(u,{key:4},{default:o(()=>[i("mdi-printer-3d")]),_:1})):s.category==="Cable"?(n(),c(u,{key:5},{default:o(()=>[i("mdi-cable-data")]),_:1})):(n(),c(u,{key:6},{default:o(()=>[i("mdi-help-circle")]),_:1})),i(" "+m(s.category),1)]),_:2},1024),t(C),t(r,{icon:"",onClick:q=>e.openUpdate(s),class:"ma-2"},{default:o(()=>[t(u,null,{default:o(()=>[i("mdi-pencil")]),_:1})]),_:2},1032,["onClick"]),t(r,{icon:"",onClick:q=>e.openDelete(s),class:"ma-2"},{default:o(()=>[t(u,null,{default:o(()=>[i("mdi-trash-can")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024),t(f,null,{default:o(()=>[t(r,{onClick:q=>e.openProductInfo(s.item_id),class:"ma-2"},{default:o(()=>[i(" Ver stock ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})),t(M,{modelValue:e.currentPage,"onUpdate:modelValue":[l[1]||(l[1]=s=>e.currentPage=s),e.handlePageChange],length:e.totalPages,"total-visible":5,class:"mt-4"},null,8,["modelValue","length","onUpdate:modelValue"]),t(v,{modelValue:e.productDialog,"onUpdate:modelValue":l[3]||(l[3]=s=>e.productDialog=s),"max-width":"500px",scrollable:""},{default:o(()=>[t(g,{class:"elevation-10"},{default:o(()=>[t(V,{class:"headline text-center"},{default:o(()=>[i(" Información del Producto ")]),_:1}),t(_,null,{default:o(()=>[t(Q,{"two-line":""},{default:o(()=>[t(S,null,{default:o(()=>[t(D,{class:"font-weight-bold"},{default:o(()=>[i("Stock")]),_:1}),t(W,null,{default:o(()=>[i(m(e.product_stock),1)]),_:1})]),_:1}),t(S,null,{default:o(()=>[t(D,{class:"font-weight-bold"},{default:o(()=>[i("Precio")]),_:1}),t(W,null,{default:o(()=>[i(m(e.product_price),1)]),_:1})]),_:1})]),_:1})]),_:1}),t(f,{class:"d-flex justify-center"},{default:o(()=>[t(r,{onClick:l[2]||(l[2]=s=>e.reset())},{default:o(()=>[i("Cerrar")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(v,{modelValue:e.dialogCreateItem,"onUpdate:modelValue":l[12]||(l[12]=s=>e.dialogCreateItem=s),"max-width":"600px",persistent:""},{default:o(()=>[t(g,null,{default:o(()=>[t(_,null,{default:o(()=>[i(" Crear Item "),t(N,{modelValue:e.valid,"onUpdate:modelValue":l[9]||(l[9]=s=>e.valid=s)},{default:o(()=>[t($,null,{default:o(()=>[t(h,null,{default:o(()=>[t(d,{cols:"12",md:"4"},{default:o(()=>[t(y,{modelValue:e.itemPosts.item_name,"onUpdate:modelValue":l[4]||(l[4]=s=>e.itemPosts.item_name=s),label:"Nombre Item",variant:"underlined",required:""},null,8,["modelValue"])]),_:1}),t(d,{cols:"12",md:"4"},{default:o(()=>[t(y,{modelValue:e.itemPosts.item_price,"onUpdate:modelValue":l[5]||(l[5]=s=>e.itemPosts.item_price=s),label:"Precio",type:"number",variant:"underlined",required:""},null,8,["modelValue"])]),_:1}),t(d,{cols:"12",md:"4"},{default:o(()=>[t(k,{modelValue:e.itemPosts.category,"onUpdate:modelValue":l[6]||(l[6]=s=>e.itemPosts.category=s),label:"Categoria",variant:"underlined",items:["Sensor","Arduino","Raspberry","Robótica","3D","Cable"],chips:"",required:""},null,8,["modelValue"])]),_:1}),t(d,{cols:"12",md:"4"},{default:o(()=>[t(k,{modelValue:e.itemPosts.inventory_id,"onUpdate:modelValue":l[7]||(l[7]=s=>e.itemPosts.inventory_id=s),label:"Inventario",variant:"underlined",required:"",items:e.inventory_array,"item-value":"inventory_id","item-title":"inventory_name",onChange:e.selectItem},null,8,["modelValue","items","onChange"])]),_:1}),t(C),t(d,{cols:"12",md:"4"},{default:o(()=>[t(y,{modelValue:e.productPost.product_stock,"onUpdate:modelValue":l[8]||(l[8]=s=>e.productPost.product_stock=s),label:"Stock",type:"number",min:"0",variant:"underlined",required:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(f,null,{default:o(()=>[t(r,{onClick:l[10]||(l[10]=s=>e.closeCreate()())},{default:o(()=>[i("Cerrar")]),_:1}),t(r,{onClick:l[11]||(l[11]=s=>e.createItem())},{default:o(()=>[i("Guardar")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(v,{modelValue:e.dialogUpdateItem,"onUpdate:modelValue":l[21]||(l[21]=s=>e.dialogUpdateItem=s),"max-width":"600px",persistent:""},{default:o(()=>[t(g,null,{default:o(()=>[t(_,null,{default:o(()=>[i(" Actualizar Item "),t(N,{modelValue:e.valid,"onUpdate:modelValue":l[18]||(l[18]=s=>e.valid=s)},{default:o(()=>[t($,null,{default:o(()=>[t(h,null,{default:o(()=>[t(d,{cols:"12",md:"4"},{default:o(()=>[t(y,{modelValue:e.itemPosts.item_name,"onUpdate:modelValue":l[13]||(l[13]=s=>e.itemPosts.item_name=s),label:"Nombre Item",variant:"underlined",required:""},null,8,["modelValue"])]),_:1}),t(d,{cols:"12",md:"4"},{default:o(()=>[t(y,{modelValue:e.itemPosts.item_price,"onUpdate:modelValue":l[14]||(l[14]=s=>e.itemPosts.item_price=s),label:"Precio",type:"number",variant:"underlined",required:""},null,8,["modelValue"])]),_:1}),t(d,{cols:"12",md:"4"},{default:o(()=>[t(k,{modelValue:e.itemPosts.category,"onUpdate:modelValue":l[15]||(l[15]=s=>e.itemPosts.category=s),label:"Categoria",variant:"underlined",items:["Sensor","Arduino","Raspberry","Robótica","3D","Cable"],chips:"",required:""},null,8,["modelValue"])]),_:1}),t(d,{cols:"12",md:"4"},{default:o(()=>[t(k,{modelValue:e.itemPosts.inventory_id,"onUpdate:modelValue":l[16]||(l[16]=s=>e.itemPosts.inventory_id=s),label:"Inventario",variant:"underlined",required:"",items:e.inventory_array,"item-value":"inventory_id","item-title":"inventory_name",onChange:e.selectItem},null,8,["modelValue","items","onChange"])]),_:1}),t(C),t(d,{cols:"12",md:"4"},{default:o(()=>[t(y,{modelValue:e.productPost.product_stock,"onUpdate:modelValue":l[17]||(l[17]=s=>e.productPost.product_stock=s),label:"Stock",type:"number",min:"0",variant:"underlined",required:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(f,null,{default:o(()=>[t(r,{onClick:l[19]||(l[19]=s=>e.closeUpdate())},{default:o(()=>[i("Cerrar")]),_:1}),t(r,{onClick:l[20]||(l[20]=s=>e.updateItem())},{default:o(()=>[i("Guardar")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(v,{modelValue:e.dialogDeleteItem,"onUpdate:modelValue":l[24]||(l[24]=s=>e.dialogDeleteItem=s),"max-width":"500px"},{default:o(()=>[t(g,null,{default:o(()=>[t(V,null,{default:o(()=>[i(" Eliminar Item ")]),_:1}),t(_,null,{default:o(()=>[i(" ¿Estás seguro de eliminar este Item? ")]),_:1}),t(f,null,{default:o(()=>[t(r,{onClick:l[22]||(l[22]=s=>e.dialogDeleteItem=!1)},{default:o(()=>[i("Cancelar")]),_:1}),t(r,{onClick:l[23]||(l[23]=s=>e.deleteItem())},{default:o(()=>[i("Eliminar")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(v,{modelValue:e.dialogWishlist,"onUpdate:modelValue":l[26]||(l[26]=s=>e.dialogWishlist=s),"max-width":"500px",persistent:"",scrollable:""},{default:o(()=>[t(g,null,{default:o(()=>[t(V,null,{default:o(()=>[i(" Agregar a la Wishlist ")]),_:1}),t(O,null,{default:o(()=>[ce]),_:1}),t(_,null,{default:o(()=>[t(G,{modelValue:e.selectedWishlist,"onUpdate:modelValue":l[25]||(l[25]=s=>e.selectedWishlist=s),items:e.wishNames,label:"Seleccionar Wishlist",required:""},null,8,["modelValue","items"]),t(h,{align:"center",justify:"center"},{default:o(()=>[t(r,{icon:"",onClick:e.decrementCount},{default:o(()=>[t(u,null,{default:o(()=>[i("mdi-minus")]),_:1})]),_:1},8,["onClick"]),P("span",me,m(e.count),1),t(r,{icon:"",onClick:e.incrementCount},{default:o(()=>[t(u,null,{default:o(()=>[i("mdi-plus")]),_:1})]),_:1},8,["onClick"])]),_:1}),P("p",pe,"Total: "+m(e.totalPrice),1)]),_:1}),t(f,null,{default:o(()=>[t(r,{onClick:e.closeCreateDialog,text:"",color:"green"},{default:o(()=>[i("Cerrar")]),_:1},8,["onClick"]),t(r,{onClick:e.saveWishlistId,text:"",color:"green",disabled:!e.selectedWishlist||e.count===0},{default:o(()=>[i("Guardar")]),_:1},8,["onClick","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}const Ie=ee(de,[["render",he],["__scopeId","data-v-1dddf4f7"]]);export{Ie as default};
