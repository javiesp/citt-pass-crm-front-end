import{_ as O,u as z,a as i,c as f,w as o,o as c,b as t,h as m,t as j,g as I,s as N,e as L,f as M,F,p as q,i as G}from"./entry.5d6c19b6.js";import{a as P}from"./axios.4d564c32.js";P.defaults.validateStatus=function(e){return e>=200&&e<300};const d=P.create({baseURL:"https://citt-pass-api-gateaway-backend-production.up.railway.app",timeout:1e5}),A=localStorage.getItem("accessToken");d.interceptors.request.use(e=>(A&&(e.headers.Authorization=`Bearer ${A}`),e),e=>Promise.reject(e));d.interceptors.response.use(e=>e,e=>Promise.reject(e));const H=e=>d.get("/users/find-one-user-by-mail",{params:{email:e}}),J=(e,s)=>(console.log(s),d.put(`/users/update-user-password/${e}`,s)),K=e=>d.get("/user-role/find-one-user-role-uid",{params:{uid_user:e}}),Q=(e,s)=>d.put("/user-role/update-user-role/"+e,s);const W={data(){return{loading:!1,loading2:!1,settingDialog:!1,loginDto:{email:null,hashed_password:null},showPassword:!1,open:["Users"],admins:[["Management","mdi-account-multiple-outline"],["Settings","mdi-cog-outline"]],cruds:[["Create","mdi-plus-outline"],["Read","mdi-file-outline"],["Update","mdi-update"],["Delete","mdi-delete"]],majors:[{title:"Informática Biomédica",value:"Informática Biomédica"},{title:"Ingeniería en Conectividad y Redes",value:"Ingeniería en Conectividad y Redes"},{title:"Ingeniería en Informática",value:"Ingeniería en Informática"},{title:"Analista Programador",value:"Analista Programador"},{title:"Analista Programador Computacional",value:"Analista Programador Computacional"},{title:"Administración de Redes y Telecomunicaciones",value:"Administración de Redes y Telecomunicaciones"},{title:"Técnico en Electricidad y Autom. Industrial",value:"Técnico en Electricidad y Autom. Industrial"},{title:"Ingeniería en Electricidad y Autom. Industrial",value:"Ingeniería en Electricidad y Autom. Industrial"}],emailUser:"",user_major:"",user_permissions:[],major_school:"",current_semester:null,items:[],post:{},passwordDTO:{id:"",hashed_password:""}}},created(){const e=localStorage.getItem("accessToken");this.verifyTokenAuth(e),this.getUserData(),console.log("LOG",this.user_major),this.items=[{text:this.emailUser,icon:"mdi-account"},{text:this.user_major,icon:"mdi-school"},{text:this.major_school,icon:"mdi-office-building"},{text:this.current_semester+" semestre",icon:"mdi-calendar"}]},methods:{verifyTokenAuth(e){const s=z();e||s.push("/login"),typeof e=="string"&&e.split(".").length!==3&&s.push("/login")},toggleShowPassword(){this.showPassword=!this.showPassword},async getUserData(){this.loading=!0,this.emailUser=localStorage.getItem("email");try{const e=await H(this.emailUser);this.passwordDTO._id=e.data._id,this.passwordDTO.hashed_password=e.data.hashed_password;const s=e.data.uid_user,n=await K(s);this.post=n.data,this.user_major=n.data.user_major,this.user_permissions=n.data.user_permissions,this.major_school=n.data.major_school,this.current_semester=n.data.current_semester,this.items=[{text:this.emailUser,icon:"mdi-account"},{text:this.user_major,icon:"mdi-school"},{text:this.major_school,icon:"mdi-office-building"},{text:this.current_semester+" semestre",icon:"mdi-calendar"}],this.loading=!1}catch(e){console.log(e),this.loding=!1}},sortSchool(e){let s="";return this.user_major==="Informática Biomédica"&&(s="Escuela de Salud"),(this.user_major==="Ingeniería en Conectividad y Redes"||this.user_major==="Ingeniería en Informática"||this.user_major==="Analista Programador"||this.user_major==="Analista Programador Computacional"||this.user_major==="Administración de Redes y Telecomunicaciones")&&(s="Escuela de Informática y Telecomunicaciones"),(this.user_major==="Técnico en Electricidad y Autom. Industrial"||this.user_major==="Ingeniería en Electricidad y Autom. Industrial")&&(s="Escuela de Ingeniería y Recursos Naturales"),s},async updateUserRole(){this.loading=!0,console.log(this.post);let e=this.sortSchool(this.user_major);console.log(this.user_major),console.log(e);const s={user_role_id:this.post.user_role_id,role_id:this.post.role_id,uid_user:this.post.uid_user,user_role:this.post.user_role,user_major:this.user_major,user_permissions:this.post.user_permissions,major_school:e,current_semester:this.current_semester};try{await Q(this.post._id,s)&&(this.getUserData(),this.settingDialog=!1,this.loading=!1)}catch(n){console.log(n),this.settingDialog=!1,this.loading=!1}},async updatePassword(){this.loading2=!0;const e={hashed_password:this.passwordDTO.hashed_password};try{const s=await J(this.passwordDTO._id,e);this.loading2=!1}catch{this.loading2=!1}}}},T=e=>(q("data-v-bb7a57c5"),e=e(),G(),e),X=T(()=>I("h2",null,"Perfil Usuario",-1)),Y=T(()=>I("p",null,"Modifica tu perfil",-1));function Z(e,s,n,$,a,g){const _=i("v-col"),l=i("v-skeleton-loader"),u=i("v-card"),b=i("v-list-title"),p=i("v-list-item"),D=i("v-card-title"),k=i("v-icon"),C=i("v-list-item-title"),U=i("v-list"),h=i("v-card-text"),v=i("v-btn"),w=i("v-card-actions"),R=i("v-autocomplete"),x=i("v-text-field"),y=i("v-row"),S=i("v-dialog"),V=i("v-list-group"),B=i("v-container");return c(),f(B,null,{default:o(()=>[t(y,null,{default:o(()=>[t(_,{cols:"12"},{default:o(()=>[X,Y]),_:1}),t(y,{class:"row-container mb-6","no-gutters":""},{default:o(()=>[a.loading?(c(),f(_,{key:0,class:"loading-container",md:"12",sm:"5"},{default:o(()=>[t(u,null,{default:o(()=>[t(l,{type:"list-item-avatar"}),t(l,{type:"list-item-avatar"}),t(l,{type:"list-item-avatar"}),t(l,{type:"list-item-avatar"}),t(l,{type:"list-item-avatar"}),t(l,{type:"list-item-avatar"}),t(l,{type:"article"}),t(l,{type:"list-item"})]),_:1})]),_:1})):(c(),f(_,{key:1,md:"12",sm:"5"},{default:o(()=>[t(u,{title:"Información de perfil"},{default:o(()=>[t(h,null,{default:o(()=>[t(p,{"prepend-avatar":"/images/profile/user2.jpg"},{default:o(()=>[t(b,null,{default:o(()=>[m(j(a.emailUser),1)]),_:1}),I("h3",null,j(a.user_major),1)]),_:1},8,["prepend-avatar"]),t(U,{opened:a.open,"onUpdate:opened":s[5]||(s[5]=r=>a.open=r)},{default:o(()=>[t(p,{"prepend-icon":"mdi-cog",title:"Ajustes de perfil"}),t(V,{value:"Users"},{activator:o(({props:r})=>[t(p,N(r,{"prepend-icon":"mdi-account-circle",title:"Users"}),null,16)]),default:o(()=>[t(u,null,{default:o(()=>[t(D,null,{default:o(()=>[m("Datos del usuario")]),_:1}),t(h,null,{default:o(()=>[t(U,null,{default:o(()=>[(c(!0),L(F,null,M(a.items,(r,E)=>(c(),f(p,{key:E},{prepend:o(()=>[t(k,{icon:r.icon},null,8,["icon"])]),default:o(()=>[t(C,{textContent:j(r.text)},null,8,["textContent"])]),_:2},1024))),128))]),_:1})]),_:1}),t(w,null,{default:o(()=>[t(v,{onClick:s[0]||(s[0]=r=>a.settingDialog=!0),"prepend-icon":"mdi-account-edit"},{default:o(()=>[m(" Actualizar configuración de perfil ")]),_:1})]),_:1})]),_:1}),t(S,{modelValue:a.settingDialog,"onUpdate:modelValue":s[4]||(s[4]=r=>a.settingDialog=r),width:"600px"},{default:o(()=>[t(u,{title:"Actualizar"},{default:o(()=>[t(h,null,{default:o(()=>[t(y,null,{default:o(()=>[t(_,null,{default:o(()=>[t(R,{label:"Carreras",modelValue:a.user_major,"onUpdate:modelValue":s[1]||(s[1]=r=>a.user_major=r),items:a.majors,variant:"underlined"},null,8,["modelValue","items"]),t(x,{label:"Semestre",modelValue:a.current_semester,"onUpdate:modelValue":s[2]||(s[2]=r=>a.current_semester=r),type:"number",min:"1",max:"12",step:"1"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(w,null,{default:o(()=>[t(v,{onClick:s[3]||(s[3]=r=>g.updateUserRole()),"prepend-icon":"mdi-account-edit"},{default:o(()=>[m(" Actualizar ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["opened"])]),_:1}),t(u,{title:"Actualizar contraseña",loading:a.loading2},{default:o(()=>[t(h,null,{default:o(()=>[t(x,{modelValue:a.passwordDTO.hashed_password,"onUpdate:modelValue":s[6]||(s[6]=r=>a.passwordDTO.hashed_password=r),label:"Password",outlined:"",dense:"",color:"blue",autocomplete:"off","append-icon":a.showPassword?"mdi-eye":"mdi-eye-off","onClick:append":g.toggleShowPassword,type:a.showPassword?"text":"password"},null,8,["modelValue","append-icon","onClick:append","type"])]),_:1}),t(w,null,{default:o(()=>[t(v,{onClick:s[7]||(s[7]=r=>g.updatePassword()),"prepend-icon":"mdi-lock-reset"},{default:o(()=>[m(" Actualizar contraseña ")]),_:1})]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1}))]),_:1})]),_:1})]),_:1})}const se=O(W,[["render",Z],["__scopeId","data-v-bb7a57c5"]]);export{se as default};
