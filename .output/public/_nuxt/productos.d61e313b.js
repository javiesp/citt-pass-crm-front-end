import{a as N}from"./axios.4d564c32.js";import{g as q,c as j,u as z,a as G}from"./wishlistApi.8f919075.js";import{_ as H,d as M,a as i,e as k,b as t,w as s,g as h,F as V,o as c,h as r,c as v,f as J,n as K,t as u}from"./entry.12f9e6e0.js";N.defaults.validateStatus=function(e){return e>=200&&e<300};const P=N.create({baseURL:"https://citt-pass-api-gateaway-backend-production.up.railway.app",timeout:1e5}),T=localStorage.getItem("accessToken");P.interceptors.request.use(e=>(T&&(e.headers.Authorization=`Bearer ${T}`),e),e=>Promise.reject(e));P.interceptors.response.use(e=>e,e=>Promise.reject(e));const X=()=>P.get("https://api-integracion.sbgtech.workers.dev/products"),Y=M({name:"productItem",data(){return{dialog:!1,dialogWishlist:!1,dialogCreateWishlist:!1,loading:!1,productArray:[],productNames:[],wishlistId:null,wishlistArray:[],wishNames:[],productSearchQuery:"",selectedProducts:{},productsFor:[],dialogVisible:!1,alertVisible:!1,errorAlertVisible:!1,loading:!1,isDisabled:!0,selectedWishlist:"",wishlistNameToIdMap:{},post:{wishlist_id:null,wishlist_name:null,budget:null,product:null},ProductDto:[],count:0,totalPrice:0,productName:null,productStock:null,wihslistBudget:null}},computed:{filteredProducts(){return console.log("INPUT: ",this.productSearchQuery),this.productSearchQuery?(this.productArray.results||[]).filter(e=>e.name.toLowerCase().includes(this.productSearchQuery.toLowerCase())):(console.log("OUTPUT: ",this.productArray.results),this.productArray.results||[])}},methods:{async getProduct(){try{this.loading=!0;const e=await X();console.log("INPUT: ",e),this.productArray=e.data,this.productNames=this.productArray.results.map(o=>o.name),console.log("OUTPUT: ",this.productArray),this.loading=!1}catch(e){console.error("PRODUCT_ERROR:",e),this.errorAlertVisible=!0}},async getWishlist(){try{const e=await q();console.log("INPUT: ",e),this.wishlistArray=e.data,this.wishlistNameToIdMap=this.wishlistArray.reduce((o,d)=>(o[d.wishlist_name]=d.wishlist_id,o),{}),this.wishNames=this.wishlistArray.map(o=>o.wishlist_name),console.log("OUTPUT: ",this.wishlistArray)}catch(e){console.error("Error fetching wishlists:",e),this.errorAlertVisible=!0}},addProductToWishlist(e){console.log("HOLA",e);const o={product_id:e.id,product_name:e.name,price:e.price,quantity:this.count};this.selectedProducts=o,this.productName=this.selectedProducts.product_name,this.productStock=e.stock,console.log("INPUT: ",e),this.dialogWishlist=!0,console.log("OUTPUT: ",this.selectedWishlist,"/",this.selectedProducts),this.isDisabled=!1},incrementCount(){this.isDisabled=!0,this.count<this.productStock?(this.count++,this.totalPrice+=this.selectedProducts.price,this.selectedProducts.quantity=this.count,console.log("Producto incrementado:",this.selectedProducts.name),console.log("Contador actual:",this.count),console.log("Precio Total:",this.totalPrice)):console.log("No se puede incrementar más, stock insuficiente")},decrementCount(){this.count>0?(this.count--,this.totalPrice-=this.selectedProducts.price,console.log("Producto decrementado:",this.selectedProducts.name),console.log("Contador actual:",this.count),console.log("Precio Total:",this.totalPrice)):(this.isDisabled=!1,console.log("No se puede decrementar más, cantidad mínima alcanzada"))},async createWishlist(){const e={wishlist_id:Math.random(),wishlist_name:this.post.wishlist_name,budget:0,product:this.ProductDto};try{this.loading=!0;const o=await j(e);console.log("POST"),console.log(o),this.loading=!1,this.dialogCreateWishlist=!1}catch(o){console.error("PRODUCT_ERROR:",o),this.errorAlertVisible=!0}},openCreateDialog(){this.dialog=!0},closeCreateDialog(){this.dialogWishlist=!1},async saveWishlistId(){console.log("WISHLIST SELECCIONADA"),console.log(this.selectedWishlist),console.log("PRODUCTOS SELECCIONADOS"),console.log(this.selectedProducts);try{this.loading=!0;const e=this.wishlistArray.find(p=>p._id===this.selectedWishlist);if(!e)throw new Error("Wishlist no encontrada");const o=e.budget||0;console.log("Presupuesto actual",o);const d=await z(this.selectedWishlist,this.selectedProducts);console.log(d);const m=o+this.totalPrice;console.log("Presupuesto final",m);const w={budget:m},y=await G(this.selectedWishlist,w);console.log("PUT"),console.log(y),this.dialogWishlist=!1,this.selectedProducts={},console.log("AGREGADO"),this.loading=!1}catch(e){console.log(e),this.loading=!1}console.log("PASS"),this.resetFields()},resetFields(){this.totalPrice=0,this.count=0,this.post.wishlist_name=""}},mounted(){this.getProduct(),this.getWishlist()}}),Z=h("h2",null,"Productos",-1),x={class:"pa-4 text-center"};function ee(e,o,d,m,w,y){const p=i("v-autocomplete"),a=i("v-col"),n=i("v-btn"),U=i("v-progress-circular"),S=i("v-img"),C=i("v-card-title"),b=i("v-icon"),g=i("v-card-text"),_=i("v-card"),f=i("v-row"),D=i("v-list-item-title"),O=i("v-avatar"),I=i("v-list-item"),E=i("v-text"),R=i("v-select"),W=i("v-card-actions"),A=i("v-dialog"),B=i("v-text-field"),L=i("v-divider"),$=i("v-spacer"),Q=i("v-alert");return c(),k(V,null,[Z,t(f,{class:"month-table"},{default:s(()=>[t(a,{cols:"3"},{default:s(()=>[t(p,{items:e.productNames,"item-value":"productArray.name",class:"mx-auto",density:"comfortable","menu-icon":"",placeholder:"Buscar Producto","prepend-inner-icon":"mdi-magnify",style:{"max-width":"350px"},theme:"light",variant:"solo","auto-select-first":"",modelValue:e.productSearchQuery,"onUpdate:modelValue":o[0]||(o[0]=l=>e.productSearchQuery=l),"item-props":"",hint:"Escriba para buscar",rounded:""},null,8,["items","modelValue"])]),_:1}),t(a,{cols:"6"},{default:s(()=>[t(n,{variant:"tonal",color:"primary","prepend-icon":"mdi-folder-outline",onClick:o[1]||(o[1]=l=>e.dialogCreateWishlist=!0)},{default:s(()=>[r(" Crear wishlist ")]),_:1})]),_:1}),e.loading?(c(),v(a,{key:0,cols:"12",class:"text-center"},{default:s(()=>[t(U,{size:200,width:17,color:"primary",indeterminate:""})]),_:1})):(c(!0),k(V,{key:1},J(e.filteredProducts,(l,F)=>(c(),v(a,{key:F,cols:"12",md:"4"},{default:s(()=>[t(_,null,{default:s(()=>[l.images&&l.images.length>0?(c(),v(S,{key:0,src:l.images[0],height:"200"},null,8,["src"])):K("",!0),t(C,null,{default:s(()=>[r(u(l.name),1)]),_:2},1024),t(g,null,{default:s(()=>[h("p",null,"Price: "+u(l.price),1),h("p",null,"Discount: "+u(l.discount),1),t(n,{icon:"",onClick:te=>e.addProductToWishlist(l)},{default:s(()=>[t(b,null,{default:s(()=>[r("mdi-heart")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),t(A,{modelValue:e.dialogWishlist,"onUpdate:modelValue":o[3]||(o[3]=l=>e.dialogWishlist=l),"max-width":"500px"},{default:s(()=>[t(_,null,{default:s(()=>[t(C,null,{default:s(()=>[r("Agregar producto a lista de deseos")]),_:1}),t(g,null,{default:s(()=>[t(I,{subtitle:e.precio},{prepend:s(()=>[t(O,{color:"grey-lighten-1"},{default:s(()=>[t(b,{color:"white"},{default:s(()=>[r("mdi-shopping")]),_:1})]),_:1})]),append:s(()=>[t(a,null,{default:s(()=>[t(f,null,{default:s(()=>[t(n,{density:"compact",icon:"mdi-minus",onClick:e.decrementCount},null,8,["onClick"]),t(n,{density:"compact",icon:"mdi-plus",onClick:e.incrementCount},null,8,["onClick"])]),_:1})]),_:1})]),default:s(()=>[t(D,null,{default:s(()=>[r(u(e.productName),1)]),_:1})]),_:1},8,["subtitle"]),t(a,null,{default:s(()=>[t(E,null,{default:s(()=>[r(" Total: "+u(e.totalPrice),1)]),_:1})]),_:1}),t(a,null,{default:s(()=>[t(R,{items:e.wishlistArray,label:"Selecciona la wishlist",modelValue:e.selectedWishlist,"onUpdate:modelValue":o[2]||(o[2]=l=>e.selectedWishlist=l),"item-value":"_id","item-title":"wishlist_name",disabled:!e.isDisabled,dense:""},null,8,["items","modelValue","disabled"])]),_:1})]),_:1}),t(W,null,{default:s(()=>[t(n,{onClick:e.closeCreateDialog},{default:s(()=>[r("Cerrar")]),_:1},8,["onClick"]),t(n,{color:"primary",disabled:!e.isDisabled,onClick:e.saveWishlistId},{default:s(()=>[r("Guardar")]),_:1},8,["disabled","onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),h("div",x,[t(A,{modelValue:e.dialogCreateWishlist,"onUpdate:modelValue":o[6]||(o[6]=l=>e.dialogCreateWishlist=l),"max-width":"600"},{default:s(()=>[t(_,{"prepend-icon":"mdi-heart",title:"Crear lista de deseos"},{default:s(()=>[t(g,null,{default:s(()=>[t(f,{dense:""},{default:s(()=>[t(a,{cols:"12",md:"12",sm:"6"},{default:s(()=>[t(B,{modelValue:e.post.wishlist_name,"onUpdate:modelValue":o[4]||(o[4]=l=>e.post.wishlist_name=l),label:"Nombre de la lista",required:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(L),t(W,null,{default:s(()=>[t($),t(n,{text:"Cerrar",variant:"plain",onClick:o[5]||(o[5]=l=>e.dialogCreateWishlist=!1)}),t(n,{color:"primary",text:"Crear",variant:"tonal",onClick:e.createWishlist},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),t(Q,{modelValue:e.errorAlertVisible,"onUpdate:modelValue":o[7]||(o[7]=l=>e.errorAlertVisible=l),dismissible:"",color:"red",border:"left",elevation:"2","colored-border":"",icon:"mdi-alert",timeout:"5000"},{default:s(()=>[r(" Oops! Ha ocurrido un problema. ")]),_:1},8,["modelValue"])],64)}const ie=H(Y,[["render",ee]]);export{ie as default};
