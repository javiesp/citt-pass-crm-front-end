import{a as W}from"./axios.4d564c32.js";import{g as S}from"./wishlistApi.b9eacd87.js";import{_ as R,d as U,a as o,e as u,f as t,w as s,F as p,h,b as a,k as r,i as y,j as C,l as $,t as n}from"./entry.bc374d72.js";W.defaults.validateStatus=function(e){return e>=200&&e<300};const f=W.create({baseURL:"http://localhost:3005/",timeout:1e5}),V=localStorage.getItem("accessToken");f.interceptors.request.use(e=>(V&&(e.headers.Authorization=`Bearer ${V}`),e),e=>Promise.reject(e));f.interceptors.response.use(e=>e,e=>Promise.reject(e));const B=()=>f.get("https://api-integracion.sbgtech.workers.dev/products"),O=U({data(){return{dialog:!1,dialogWishlist:!1,productArray:[],productNames:[],wishlistId:null,wishlistArray:[],wishNames:[],productSearchQuery:"",selectedProducts:[],dialogVisible:!1,alertVisible:!1,errorAlertVisible:!1,loading:!1,selectedWishlist:"",wishlistNameToIdMap:{}}},computed:{filteredProducts(){return this.productSearchQuery?(this.productArray.results||[]).filter(e=>e.name.toLowerCase().includes(this.productSearchQuery.toLowerCase())):this.productArray.results||[]}},methods:{async getProduct(){this.loading=!0;try{const e=await B();this.productArray=e.data,this.productNames=this.productArray.results.map(i=>i.name)}catch(e){console.error("PRODUCT_ERROR:",e),this.errorAlertVisible=!0}finally{this.loading=!1}},async getWishlist(){try{const e=await S();this.wishlistArray=e.data,this.wishlistNameToIdMap=this.wishlistArray.reduce((i,m)=>(i[m.wishlist_name]=m.wishlist_id,i),{}),this.wishNames=this.wishlistArray.map(i=>i.wishlist_name)}catch(e){console.error("Error fetching wishlists:",e),this.errorAlertVisible=!0}},addProductToWishlist(e){const i={id:e.id,name:e.name,price:e.price,quantity:1};this.selectedProducts.push(i),this.dialogWishlist=!0},openCreateDialog(){this.dialog=!0},closeCreateDialog(){this.dialogWishlist=!1},onWishlistChange(e){this.selectedWishlist=e},saveWishlistId(){this.selectedWishlist in this.wishlistNameToIdMap?(this.wishlistId=this.wishlistNameToIdMap[this.selectedWishlist],this.dialogWishlist=!1,console.log("Wishlist ID guardado:",this.wishlistId)):(console.error("Wishlist no encontrada:",this.selectedWishlist),this.errorAlertVisible=!0)}},mounted(){this.getProduct(),this.getWishlist()}}),E=h("h2",null,"Productos",-1);function Q(e,i,m,L,M,j){const b=o("v-autocomplete"),d=o("v-col"),c=o("v-btn"),P=o("v-img"),_=o("v-card-title"),k=o("v-icon"),g=o("v-card-text"),v=o("v-card"),w=o("v-row"),A=o("v-select"),N=o("v-card-actions"),I=o("v-dialog"),T=o("v-alert");return a(),u(p,null,[E,t(w,{class:"month-table"},{default:s(()=>[t(d,{cols:"3"},{default:s(()=>[t(b,{items:e.productNames,"item-value":"productArray.name",class:"mx-auto",density:"comfortable","menu-icon":"",placeholder:"Buscar Producto","prepend-inner-icon":"mdi-magnify",style:{"max-width":"350px"},theme:"light",variant:"solo","auto-select-first":"",modelValue:e.productSearchQuery,"onUpdate:modelValue":i[0]||(i[0]=l=>e.productSearchQuery=l),"item-props":"",hint:"Escriba para buscar",rounded:""},null,8,["items","modelValue"])]),_:1}),t(d,{cols:"6",class:"text-right"},{default:s(()=>[t(c,{variant:"tonal",color:"primary","prepend-icon":"mdi-folder-outline",onClick:e.openCreateDialog},{default:s(()=>[r("Ver wishlist")]),_:1},8,["onClick"])]),_:1}),t(d,null,{default:s(()=>[t(w,null,{default:s(()=>[(a(!0),u(p,null,y(e.filteredProducts,(l,D)=>(a(),C(d,{key:D,cols:"12",md:"4"},{default:s(()=>[t(v,null,{default:s(()=>[l.images&&l.images.length>0?(a(),C(P,{key:0,src:l.images[0],height:"200"},null,8,["src"])):$("",!0),t(_,null,{default:s(()=>[r(n(l.name),1)]),_:2},1024),t(g,null,{default:s(()=>[h("p",null,"Price: "+n(l.price),1),h("p",null,"Discount: "+n(l.discount),1),t(c,{icon:"",onClick:q=>e.addProductToWishlist(l)},{default:s(()=>[t(k,null,{default:s(()=>[r("mdi-heart")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),t(I,{modelValue:e.dialogWishlist,"onUpdate:modelValue":i[2]||(i[2]=l=>e.dialogWishlist=l),"max-width":"500px"},{default:s(()=>[t(v,null,{default:s(()=>[t(_,null,{default:s(()=>[r("Wishlist")]),_:1}),t(g,null,{default:s(()=>[h("ul",null,[(a(!0),u(p,null,y(e.selectedProducts,l=>(a(),u("li",{key:l.id}," PRODUCTO: "+n(l.name)+" PRECIO: $"+n(l.price),1))),128)),t(A,{items:e.wishNames,label:"Selecciona la wishlist",modelValue:e.selectedWishlist,"onUpdate:modelValue":i[1]||(i[1]=l=>e.selectedWishlist=l),onChange:e.onWishlistChange,dense:""},null,8,["items","modelValue","onChange"])])]),_:1}),t(N,null,{default:s(()=>[t(c,{onClick:e.closeCreateDialog},{default:s(()=>[r("Cerrar")]),_:1},8,["onClick"]),t(c,{onClick:e.saveWishlistId},{default:s(()=>[r("Guardar")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(T,{modelValue:e.errorAlertVisible,"onUpdate:modelValue":i[3]||(i[3]=l=>e.errorAlertVisible=l),dismissible:"",color:"red",border:"left",elevation:"2","colored-border":"",icon:"mdi-alert",timeout:"5000"},{default:s(()=>[r(" Oops! Ha ocurrido un problema. ")]),_:1},8,["modelValue"])],64)}const H=R(O,[["render",Q]]);export{H as default};
